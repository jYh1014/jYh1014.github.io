I"Î<h2 id="iteratoréå†å™¨">iteratoréå†å™¨</h2>

<blockquote>
  <p>es6ä¸Šæ˜¯è¿™æ ·å®šä¹‰çš„ï¼šå®ƒæ˜¯ä¸€ç§æ¥å£ï¼Œä¸ºå„ç§ä¸åŒçš„æ•°æ®ç»“æ„æä¾›ç»Ÿä¸€çš„è®¿é—®æœºåˆ¶ã€‚ä»»ä½•æ•°æ®ç»“æ„åªè¦éƒ¨ç½² Iterator æ¥å£ï¼Œå°±å¯ä»¥å®Œæˆéå†æ“ä½œ</p>
</blockquote>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre></td><td class="rouge-code"><pre>æ¨¡æ‹Ÿä¸€ä¸ªéå†å™¨ç”Ÿå­˜å‡½æ•°
<span class="k">function </span>makeIterator<span class="o">(</span>arr<span class="o">){</span>
    <span class="nb">let </span>index <span class="o">=</span> 0
    <span class="k">return</span> <span class="o">{</span>
        next: <span class="k">function</span><span class="o">(){</span>
            <span class="k">if</span><span class="o">(</span>index &lt; arr.length<span class="o">){</span>
                <span class="k">return</span> <span class="o">{</span>
                    value: arr[index++],
                    <span class="k">done</span>: <span class="nb">false</span>
                <span class="o">}</span>
            <span class="o">}</span><span class="k">else</span><span class="o">{</span>
                <span class="k">return</span> <span class="o">{</span>
                    value: undefined,
                    <span class="k">done</span>: <span class="nb">true</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="nb">let </span>it <span class="o">=</span> makeIterator<span class="o">([</span><span class="s2">"a"</span>,<span class="s2">"b"</span><span class="o">])</span>
console.log<span class="o">(</span>it.next<span class="o">())</span>
console.log<span class="o">(</span>it.next<span class="o">())</span>
console.log<span class="o">(</span>it.next<span class="o">())</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>ES6 è§„å®šï¼Œé»˜è®¤çš„ Iterator æ¥å£éƒ¨ç½²åœ¨æ•°æ®ç»“æ„çš„Symbol.iteratorå±æ€§ï¼Œæˆ–è€…è¯´ï¼Œä¸€ä¸ªæ•°æ®ç»“æ„åªè¦å…·æœ‰Symbol.iteratorå±æ€§ï¼Œå°±å¯ä»¥è®¤ä¸ºæ˜¯â€œå¯éå†çš„â€.<br />
åŸç”Ÿå…·å¤‡ Iterator æ¥å£çš„æ•°æ®ç»“æ„å¦‚ä¸‹:</p>
<ul>
  <li>Array</li>
  <li>Map</li>
  <li>Set</li>
  <li>String</li>
  <li>TypedArray</li>
  <li>å‡½æ•°çš„ arguments å¯¹è±¡</li>
  <li>NodeList å¯¹è±¡</li>
</ul>

<p>ä¸‹é¢æ˜¯ä¸ºä¸€ä¸ªå¯¹è±¡æ·»åŠ iteratoræ¥å£çš„ä¾‹å­</p>
<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre></td><td class="rouge-code"><pre><span class="nb">let </span>obj <span class="o">=</span> <span class="o">{</span>
  data: <span class="o">[</span> <span class="s1">'hello'</span>, <span class="s1">'world'</span> <span class="o">]</span>,
  <span class="o">[</span>Symbol.iterator]<span class="o">()</span> <span class="o">{</span>
    const self <span class="o">=</span> this<span class="p">;</span>
    <span class="nb">let </span>index <span class="o">=</span> 0<span class="p">;</span>
    <span class="k">return</span> <span class="o">{</span>
      next<span class="o">()</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span>index &lt; self.data.length<span class="o">)</span> <span class="o">{</span>
          <span class="k">return</span> <span class="o">{</span>
            value: self.data[index++],
            <span class="k">done</span>: <span class="nb">false</span>
          <span class="o">}</span><span class="p">;</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
          <span class="k">return</span> <span class="o">{</span> value: undefined, <span class="k">done</span>: <span class="nb">true</span> <span class="o">}</span><span class="p">;</span>
        <span class="o">}</span>
      <span class="o">}</span>
    <span class="o">}</span><span class="p">;</span>
  <span class="o">}</span>
<span class="o">}</span><span class="p">;</span>
<span class="k">for</span><span class="o">(</span><span class="nb">let </span>item of obj<span class="o">){</span>
    console.log<span class="o">(</span>item<span class="o">)</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="generatorå‡½æ•°">generatorå‡½æ•°</h2>

<h2 id="coæ¨¡å—">coæ¨¡å—</h2>

<blockquote>
  <p>ç”¨äº Generator å‡½æ•°çš„è‡ªåŠ¨æ‰§è¡Œï¼Œcoæ¨¡å—çº¦å®šï¼Œyieldå‘½ä»¤åé¢åªèƒ½æ˜¯ Thunk å‡½æ•°æˆ– Promise å¯¹è±¡</p>
</blockquote>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre></td><td class="rouge-code"><pre>const fs <span class="o">=</span> require<span class="o">(</span><span class="s2">"fs"</span><span class="o">)</span>.promises

<span class="k">function*</span> <span class="nb">read</span><span class="o">()</span> <span class="o">{</span>
    <span class="nb">let </span>name <span class="o">=</span> yield fs.readFile<span class="o">(</span><span class="s2">"name.txt"</span>, <span class="s2">"utf8"</span><span class="o">)</span>
    <span class="nb">let </span>age <span class="o">=</span> yield fs.readFile<span class="o">(</span>name, <span class="s2">"utf8"</span><span class="o">)</span>
    <span class="nb">let </span>xx <span class="o">=</span> yield <span class="o">{</span> a: age + 20 <span class="o">}</span>
    <span class="k">return </span>xx
<span class="o">}</span>
co<span class="o">(</span><span class="nb">read</span><span class="o">)</span>.then<span class="o">(</span>data <span class="o">=&gt;</span> <span class="o">{</span>
    console.log<span class="o">(</span>data<span class="o">)</span>
<span class="o">})</span>
//æºç å®ç°å¦‚ä¸‹ï¼š
<span class="k">function </span>co<span class="o">(</span>gen<span class="o">)</span> <span class="o">{</span>
    <span class="nb">let </span>self <span class="o">=</span> this
    <span class="k">return </span>new Promise<span class="o">((</span>resolve, reject<span class="o">)</span> <span class="o">=&gt;</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span>typeof gen <span class="o">===</span> <span class="s2">"function"</span><span class="o">)</span> <span class="o">{</span>
            gen <span class="o">=</span> gen.call<span class="o">(</span>self<span class="o">)</span>
        <span class="o">}</span>
        <span class="k">function </span>next<span class="o">(</span>data<span class="o">)</span> <span class="o">{</span>
            <span class="nb">let</span> <span class="o">{</span> value, <span class="k">done</span> <span class="o">}</span> <span class="o">=</span> gen.next<span class="o">(</span>data<span class="o">)</span>
            <span class="k">if</span> <span class="o">(</span><span class="k">done</span><span class="o">)</span> <span class="o">{</span>
                resolve<span class="o">(</span>value<span class="o">)</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                Promise.resolve<span class="o">(</span>value<span class="o">)</span>.then<span class="o">(</span>data <span class="o">=&gt;</span> <span class="o">{</span>
                    console.log<span class="o">(</span>data<span class="o">)</span>
                    next<span class="o">(</span>data<span class="o">)</span>
                <span class="o">}</span>, err <span class="o">=&gt;</span> console.log<span class="o">(</span>err<span class="o">))</span>
            <span class="o">}</span>

        <span class="o">}</span>
        next<span class="o">()</span>
    <span class="o">})</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>
:ET