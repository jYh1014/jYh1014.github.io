I"›<h2 id="promiseä»‹ç»">promiseä»‹ç»</h2>
<blockquote>
  <p><strong>1.promiseæ˜¯ä»€ä¹ˆ?</strong> <br />
promiseå¯¹è±¡æ˜¯ä¸€ä¸ªæ„é€ å‡½æ•°,newäº†ä¹‹åä¼šç«‹å³æ‰§è¡Œã€‚</p>
</blockquote>

<blockquote>
  <p><strong>2.promiseçš„åº”ç”¨åœºæ™¯</strong> <br />
Promise æ˜¯å¼‚æ­¥ç¼–ç¨‹çš„ä¸€ç§è§£å†³æ–¹æ¡ˆã€‚ä¸»è¦æ˜¯ä¸ºäº†è§£å†³å›è°ƒåœ°ç‹±çš„é—®é¢˜ã€‚ä¸‹é¢æ¥çœ‹ä¸ªå›è°ƒåµŒå¥—çš„å°ä¾‹å­ï¼š</p>
</blockquote>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><!-- <td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre></td> --><td class="rouge-code"><pre>fs.readFile("name.txt", "utf8", function(err,data){
    if(data){
        fs.readFile(data, "utf8", function(err1,data1){
            // console.log(err1,data1)
        })
    }
})
æ”¹é€ æˆpromiseåï¼Œç”¨é“¾å¼è°ƒç”¨çš„æ–¹å¼ã€‚
function readFile(...args) {
    return new Promise((resolve, reject) =&gt; {
        fs.readFile(...args, (err, data) =&gt; {
            if(err) reject(err)
            resolve(data)
        })
    })
}
readFile("name.txt", "utf8").then(data =&gt; {
    return readFile(data, "utf8");
}, err =&gt; {
    console.log("err1"+err)
})
</pre></td></tr></tbody></table></code></pre></div></div>

<blockquote>
  <p><strong>3.promiseåŸç†</strong></p>
</blockquote>

<p>é¦–å…ˆå®ç°ä¸€ä¸ªæœ€ç®€å•çš„ï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><!-- <td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre></td> --><td class="rouge-code"><pre>let promise = new Promise((resolve, reject) =&gt; {
    resolve("ok")
})
promise.then(data =&gt; {
    console.log(â€œsuccess: " + data)
}, err =&gt; {
    console.log("error: " + err)
})
æºç å®ç°å¦‚ä¸‹ï¼š
class Promise {
    constructor(executor){
        this.value = undefined
        this.reason = undefined
        let resolve = (value) =&gt; {
            this.value = value
        }
        let reject = (reason) =&gt; {
            this.reason = reason
        }
        executor(resolve, reject)
    }
    then(onfulfilled, onreject){
        onfulfilled(this.value)
    }
}
module.exports = Promise
</pre></td></tr></tbody></table></code></pre></div></div>
<p>resolveæ˜¯å¼‚æ­¥æ“ä½œæˆåŠŸåæ‰§è¡Œçš„ï¼Œå¦‚æœå¼‚æ­¥æ“ä½œå¤±è´¥åˆ™è¦æ‰§è¡Œreject,æ­¤æ—¶å°±è¦è€ƒè™‘åŠ çŠ¶æ€ï¼ŒæˆåŠŸâ€FULFILLEDâ€ã€å¤±è´¥â€REJECTEDâ€ã€è¿›è¡Œä¸­â€PENDDINGâ€</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><!-- <td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre></td> --><td class="rouge-code"><pre>let promise = new Promise((resolve, reject) =&gt; {
    reject("å‡ºé”™äº†")
})
æºç å®ç°ï¼š
const PENDDING = "PENDDING"
const FULFILLED = "FULFILLED"
const REJECTED = "REJECTED"
class Promise{
    constructor(executor){
        this.value = undefined
        this.reason = undefined
        this.status = undefined
        let resolve = (value) =&gt; {
            this.value = value
            this.status = FULFILLED 
        }
        let reject = (reason) =&gt; {
            this.reason = reason
            this.status = REJECTED
        }
        executor(resolve, reject)
    }
    then(onfulfilled, onreject){
        if(this.status === FULFILLED){
            onfulfilled(this.value)
        }
        if(this.status === REJECTED){
            onreject(this.reason)
        }
        
    }
}
module.exports = Promise
</pre></td></tr></tbody></table></code></pre></div></div>
<p>åˆ°æ­¤ä¸€ä¸ªç®€å•çš„promiseæºç å·²ç»å·®ä¸å¤šäº†ï¼Œä½†æ˜¯å®é™…åº”ç”¨ä¸­å¾€å¾€å¾ˆå¤æ‚ï¼Œæœ€å¸¸è§çš„å°±æ˜¯å’Œå®šæ—¶å™¨çš„ç»„åˆã€‚</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><!-- <td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
</pre></td> --><td class="rouge-code"><pre>let promise = new Promise((resolve, reject) =&gt; {
    setTimeout(() =&gt; {
        resolve("ok")
    },1000)
})
promise.then(data =&gt; {
    console.log(â€œsuccess: " + data)
}, err =&gt; {
    console.log("error: " + err)
})
è¿™ç§æƒ…å†µéœ€è¦åˆ©ç”¨resolveCallbackså’ŒrejectCallbacksæ¥åšä¸€ä¸ªç¼“å­˜ã€‚

class Promise{
    constructor(executor){
        this.value = undefined
        this.reason = undefined
        this.status = PENDDING
        this.resolveCallbacks = []
        this.rejectCallbacks = []
        let resolve = (value) =&gt; {
            this.value = value
            this.status = FULFILLED 
            this.resolveCallbacks.forEach(fn =&gt; fn())
        }
        let reject = (reason) =&gt; {
            this.reason = reason
            this.status = REJECTED
            this.rejectCallbacks.forEach(fn =&gt; fn())
        }
        executor(resolve, reject)
    }
    then(onfulfilled, onreject){
        if(this.status === FULFILLED){
            onfulfilled(this.value)
        }
        if(this.status === REJECTED){
            onreject(this.reason)
        }
        if(this.status === PENDDING){
            this.resolveCallbacks.push(() =&gt; {
                onfulfilled(this.value)
            })
            this.rejectCallbacks.push(() =&gt; {
                onreject(this.reason)
            })
        }
    }
}
module.exports = Promise
</pre></td></tr></tbody></table></code></pre></div></div>
:ET