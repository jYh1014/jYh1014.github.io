I"ãT<h2 id="iteratoréå†å™¨">iteratoréå†å™¨</h2>

<blockquote>
  <p>es6ä¸Šæ˜¯è¿™æ ·å®šä¹‰çš„ï¼šå®ƒæ˜¯ä¸€ç§æ¥å£ï¼Œä¸ºå„ç§ä¸åŒçš„æ•°æ®ç»“æ„æä¾›ç»Ÿä¸€çš„è®¿é—®æœºåˆ¶ã€‚ä»»ä½•æ•°æ®ç»“æ„åªè¦éƒ¨ç½² Iterator æ¥å£ï¼Œå°±å¯ä»¥å®Œæˆéå†æ“ä½œ</p>
</blockquote>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre></td><td class="rouge-code"><pre>æ¨¡æ‹Ÿä¸€ä¸ªéå†å™¨ç”Ÿå­˜å‡½æ•°
<span class="k">function </span>makeIterator<span class="o">(</span>arr<span class="o">){</span>
    <span class="nb">let </span>index <span class="o">=</span> 0
    <span class="k">return</span> <span class="o">{</span>
        next: <span class="k">function</span><span class="o">(){</span>
            <span class="k">if</span><span class="o">(</span>index &lt; arr.length<span class="o">){</span>
                <span class="k">return</span> <span class="o">{</span>
                    value: arr[index++],
                    <span class="k">done</span>: <span class="nb">false</span>
                <span class="o">}</span>
            <span class="o">}</span><span class="k">else</span><span class="o">{</span>
                <span class="k">return</span> <span class="o">{</span>
                    value: undefined,
                    <span class="k">done</span>: <span class="nb">true</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="nb">let </span>it <span class="o">=</span> makeIterator<span class="o">([</span><span class="s2">"a"</span>,<span class="s2">"b"</span><span class="o">])</span>
console.log<span class="o">(</span>it.next<span class="o">())</span>
console.log<span class="o">(</span>it.next<span class="o">())</span>
console.log<span class="o">(</span>it.next<span class="o">())</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>ES6 è§„å®šï¼Œé»˜è®¤çš„ Iterator æ¥å£éƒ¨ç½²åœ¨æ•°æ®ç»“æ„çš„Symbol.iteratorå±æ€§ï¼Œæˆ–è€…è¯´ï¼Œä¸€ä¸ªæ•°æ®ç»“æ„åªè¦å…·æœ‰Symbol.iteratorå±æ€§ï¼Œå°±å¯ä»¥è®¤ä¸ºæ˜¯â€œå¯éå†çš„â€.<br />
åŸç”Ÿå…·å¤‡ Iterator æ¥å£çš„æ•°æ®ç»“æ„å¦‚ä¸‹:</p>
<ul>
  <li>Array</li>
  <li>Map</li>
  <li>Set</li>
  <li>String</li>
  <li>TypedArray</li>
  <li>å‡½æ•°çš„ arguments å¯¹è±¡</li>
  <li>NodeList å¯¹è±¡</li>
</ul>

<p>ä¸‹é¢æ˜¯ä¸ºä¸€ä¸ªå¯¹è±¡æ·»åŠ iteratoræ¥å£çš„ä¾‹å­</p>
<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre></td><td class="rouge-code"><pre><span class="nb">let </span>obj <span class="o">=</span> <span class="o">{</span>
  data: <span class="o">[</span> <span class="s1">'hello'</span>, <span class="s1">'world'</span> <span class="o">]</span>,
  <span class="o">[</span>Symbol.iterator]<span class="o">()</span> <span class="o">{</span>
    const self <span class="o">=</span> this<span class="p">;</span>
    <span class="nb">let </span>index <span class="o">=</span> 0<span class="p">;</span>
    <span class="k">return</span> <span class="o">{</span>
      next<span class="o">()</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span>index &lt; self.data.length<span class="o">)</span> <span class="o">{</span>
          <span class="k">return</span> <span class="o">{</span>
            value: self.data[index++],
            <span class="k">done</span>: <span class="nb">false</span>
          <span class="o">}</span><span class="p">;</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
          <span class="k">return</span> <span class="o">{</span> value: undefined, <span class="k">done</span>: <span class="nb">true</span> <span class="o">}</span><span class="p">;</span>
        <span class="o">}</span>
      <span class="o">}</span>
    <span class="o">}</span><span class="p">;</span>
  <span class="o">}</span>
<span class="o">}</span><span class="p">;</span>
<span class="k">for</span><span class="o">(</span><span class="nb">let </span>item of obj<span class="o">){</span>
    console.log<span class="o">(</span>item<span class="o">)</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="generatorå‡½æ•°">generatorå‡½æ•°</h2>

<blockquote>
  <p>åœ¨äº†è§£äº†å›è°ƒå‡½æ•°å’Œpromiseè§£å†³å¼‚æ­¥ç¼–ç¨‹çš„ä¸è¶³ä¹‹åï¼Œgeneratorå‡½æ•°å¯ä»¥è§£å†³è¿™äº›é—®é¢˜ã€‚
è¿˜æœ‰ä¸€ç§å¤„ç†å¼‚æ­¥ç¼–ç¨‹çš„æ–¹æ¡ˆå«åšåç¨‹ï¼šæ„æ€æ˜¯å¤šä¸ªçº¿ç¨‹äº’ç›¸åä½œï¼Œå®Œæˆå¼‚æ­¥ä»»åŠ¡ã€‚</p>
</blockquote>

<p>å®ƒçš„è¿è¡Œæµç¨‹å¤§è‡´å¦‚ä¸‹ï¼š</p>
<ul>
  <li>ç¬¬ä¸€æ­¥ï¼Œåç¨‹Aå¼€å§‹æ‰§è¡Œ</li>
  <li>ç¬¬äºŒæ­¥ï¼Œåç¨‹Aæ‰§è¡Œåˆ°ä¸€åŠï¼Œè¿›å…¥æš‚åœï¼Œæ‰§è¡Œæƒè½¬ç§»åˆ°åç¨‹B</li>
  <li>ç¬¬ä¸‰æ­¥ï¼Œï¼ˆä¸€æ®µæ—¶é—´åï¼‰åç¨‹Bäº¤è¿˜æ‰§è¡Œæƒ</li>
  <li>ç¬¬å››æ­¥ï¼Œåç¨‹Aæ¢å¤æ‰§è¡Œ</li>
</ul>

<p>ä¸Šé¢æµç¨‹çš„åç¨‹Aï¼Œå°±æ˜¯å¼‚æ­¥ä»»åŠ¡ï¼Œå› ä¸ºå®ƒåˆ†æˆä¸¤æ®µï¼ˆæˆ–å¤šæ®µï¼‰æ‰§è¡Œã€‚
Generator å‡½æ•°æ˜¯åç¨‹åœ¨ ES6 çš„å®ç°ï¼Œæœ€å¤§ç‰¹ç‚¹å°±æ˜¯å¯ä»¥äº¤å‡ºå‡½æ•°çš„æ‰§è¡Œæƒï¼ˆå³æš‚åœæ‰§è¡Œï¼‰,yieldå‘½ä»¤æ˜¯å¼‚æ­¥ä¸¤ä¸ªé˜¶æ®µçš„åˆ†ç•Œçº¿ã€‚</p>

<p>ä¸‹é¢çœ‹ä¸€ä¸ªç”¨Generator å‡½æ•°æ¥æ‰§è¡Œå¼‚æ­¥ä»»åŠ¡çš„ä¾‹å­ï¼š</p>
<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="rouge-code"><pre><span class="nb">let </span>fetch <span class="o">=</span> require<span class="o">(</span><span class="s1">'node-fetch'</span><span class="o">)</span><span class="p">;</span>

<span class="k">function*</span> gen<span class="o">(){</span>
  <span class="nb">let </span>url <span class="o">=</span> <span class="s1">'https://api.github.com/users/github'</span><span class="p">;</span>
  <span class="nb">let </span>result <span class="o">=</span> yield fetch<span class="o">(</span>url<span class="o">)</span><span class="p">;</span>
  console.log<span class="o">(</span>result.bio<span class="o">)</span><span class="p">;</span>
<span class="o">}</span>
<span class="nb">let </span>g <span class="o">=</span> gen<span class="o">()</span><span class="p">;</span>
<span class="nb">let </span>result <span class="o">=</span> g.next<span class="o">()</span><span class="p">;</span>

result.value.then<span class="o">(</span><span class="k">function</span><span class="o">(</span>data<span class="o">){</span>
  <span class="k">return </span>data.json<span class="o">()</span><span class="p">;</span>
<span class="o">})</span>.then<span class="o">(</span><span class="k">function</span><span class="o">(</span>data<span class="o">){</span>
  g.next<span class="o">(</span>data<span class="o">)</span><span class="p">;</span>
<span class="o">})</span><span class="p">;</span>
å¯ä»¥çœ‹å‡ºè™½ç„¶ Generator å‡½æ•°å°†å¼‚æ­¥æ“ä½œè¡¨ç¤ºå¾—å¾ˆç®€æ´ï¼Œä½†æ˜¯æµç¨‹ç®¡ç†å´ä¸æ–¹ä¾¿ã€‚
</pre></td></tr></tbody></table></code></pre></div></div>
<p>es6æ–‡æ¡£ä¸ŠæŒ‡å‡ºthunkå‡½æ•°å¯ä»¥ç”¨äº Generator å‡½æ•°çš„è‡ªåŠ¨æµç¨‹ç®¡ç†ã€‚</p>

<h2 id="thunkå‡½æ•°">Thunkå‡½æ•°</h2>

<blockquote>
  <p>ç¼–è¯‘å™¨çš„â€œä¼ åè°ƒç”¨â€å®ç°ï¼Œæ˜¯å°†å‚æ•°æ”¾åˆ°ä¸€ä¸ªä¸´æ—¶å‡½æ•°ä¹‹ä¸­ï¼Œå†å°†è¿™ä¸ªä¸´æ—¶å‡½æ•°ä¼ å…¥å‡½æ•°ä½“ã€‚è¿™ä¸ªä¸´æ—¶å‡½æ•°å°±å«åš Thunk å‡½æ•°</p>
</blockquote>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="rouge-code"><pre><span class="k">function </span>f<span class="o">(</span>m<span class="o">)</span> <span class="o">{</span>
  <span class="k">return </span>m <span class="k">*</span> 2<span class="p">;</span>
<span class="o">}</span>
f<span class="o">(</span>x + 5<span class="o">)</span><span class="p">;</span>

// ç­‰åŒäº

<span class="nb">let </span>thunk <span class="o">=</span> <span class="k">function</span> <span class="o">()</span> <span class="o">{</span>
  <span class="k">return </span>x + 5<span class="p">;</span>
<span class="o">}</span><span class="p">;</span>
<span class="k">function </span>f<span class="o">(</span>thunk<span class="o">)</span> <span class="o">{</span>
  <span class="k">return </span>thunk<span class="o">()</span> <span class="k">*</span> 2<span class="p">;</span>
<span class="o">}</span>

</pre></td></tr></tbody></table></code></pre></div></div>
<blockquote>
  <p>JavaScript è¯­è¨€æ˜¯ä¼ å€¼è°ƒç”¨,Thunk å‡½æ•°æ›¿æ¢çš„ä¸æ˜¯è¡¨è¾¾å¼ï¼Œè€Œæ˜¯å¤šå‚æ•°å‡½æ•°ï¼Œå°†å…¶æ›¿æ¢æˆä¸€ä¸ªåªæ¥å—å›è°ƒå‡½æ•°ä½œä¸ºå‚æ•°çš„å•å‚æ•°å‡½æ•°ã€‚
ä»»ä½•å‡½æ•°ï¼Œåªè¦å‚æ•°æœ‰å›è°ƒå‡½æ•°ï¼Œå°±èƒ½å†™æˆ Thunk å‡½æ•°çš„å½¢å¼</p>
</blockquote>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="rouge-code"><pre>// æ­£å¸¸ç‰ˆæœ¬çš„readFileï¼ˆå¤šå‚æ•°ç‰ˆæœ¬ï¼‰
fs.readFile<span class="o">(</span>fileName, callback<span class="o">)</span><span class="p">;</span>

// Thunkç‰ˆæœ¬çš„readFileï¼ˆå•å‚æ•°ç‰ˆæœ¬ï¼‰
<span class="nb">let </span>Thunk <span class="o">=</span> <span class="k">function</span> <span class="o">(</span>fileName<span class="o">)</span> <span class="o">{</span>
  <span class="k">return function</span> <span class="o">(</span>callback<span class="o">)</span> <span class="o">{</span>
    <span class="k">return </span>fs.readFile<span class="o">(</span>fileName, callback<span class="o">)</span><span class="p">;</span>
  <span class="o">}</span><span class="p">;</span>
<span class="o">}</span><span class="p">;</span>

<span class="nb">let </span>readFileThunk <span class="o">=</span> Thunk<span class="o">(</span>fileName<span class="o">)</span><span class="p">;</span>
readFileThunk<span class="o">(</span>callback<span class="o">)</span><span class="p">;</span>

</pre></td></tr></tbody></table></code></pre></div></div>
<h2 id="thunkify-æ¨¡å—">Thunkify æ¨¡å—</h2>
<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre></td><td class="rouge-code"><pre>//ä½¿ç”¨æ–¹å¼ï¼šä»¥è¯»å–æ–‡ä»¶ä¸ºä¾‹
<span class="nb">let </span>thunkify <span class="o">=</span> require<span class="o">(</span><span class="s1">'thunkify'</span><span class="o">)</span><span class="p">;</span>
<span class="nb">let </span>fs <span class="o">=</span> require<span class="o">(</span><span class="s1">'fs'</span><span class="o">)</span><span class="p">;</span>
<span class="nb">let read</span> <span class="o">=</span> thunkify<span class="o">(</span>fs.readFile<span class="o">)</span><span class="p">;</span>
<span class="nb">read</span><span class="o">(</span><span class="s1">'package.json'</span><span class="o">)(</span><span class="k">function</span><span class="o">(</span>err, str<span class="o">){</span>
  // ...
<span class="o">})</span><span class="p">;</span>
//æºç å®ç°ï¼š
<span class="k">function </span>thunkify<span class="o">(</span>fn<span class="o">)</span> <span class="o">{</span>
  <span class="k">return function</span><span class="o">()</span> <span class="o">{</span>
    <span class="nb">let </span>args <span class="o">=</span> new Array<span class="o">(</span>arguments.length<span class="o">)</span><span class="p">;</span>
    <span class="nb">let </span>ctx <span class="o">=</span> this<span class="p">;</span>

    <span class="k">for</span> <span class="o">(</span><span class="nb">let </span>i <span class="o">=</span> 0<span class="p">;</span> i &lt; args.length<span class="p">;</span> ++i<span class="o">)</span> <span class="o">{</span>
      args[i] <span class="o">=</span> arguments[i]<span class="p">;</span>
    <span class="o">}</span>

    <span class="k">return function</span> <span class="o">(</span><span class="k">done</span><span class="o">)</span> <span class="o">{</span>
      <span class="nb">let </span>called<span class="p">;</span>
      args.push<span class="o">(</span><span class="k">function</span> <span class="o">()</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span>called<span class="o">)</span> <span class="k">return</span><span class="p">;</span>
        called <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
        <span class="k">done</span>.apply<span class="o">(</span>null, arguments<span class="o">)</span><span class="p">;</span>
      <span class="o">})</span><span class="p">;</span>

      try <span class="o">{</span>
        fn.apply<span class="o">(</span>ctx, args<span class="o">)</span><span class="p">;</span>
      <span class="o">}</span> catch <span class="o">(</span>err<span class="o">)</span> <span class="o">{</span>
        <span class="k">done</span><span class="o">(</span>err<span class="o">)</span><span class="p">;</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<h2 id="generator-å‡½æ•°çš„æµç¨‹ç®¡ç†">Generator å‡½æ•°çš„æµç¨‹ç®¡ç†</h2>
<blockquote>
  <p>Thunk å‡½æ•°ç°åœ¨å¯ä»¥ç”¨äº Generator å‡½æ•°çš„è‡ªåŠ¨æµç¨‹ç®¡ç†</p>
</blockquote>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre></td><td class="rouge-code"><pre><span class="nb">let </span>fs <span class="o">=</span> require<span class="o">(</span><span class="s1">'fs'</span><span class="o">)</span><span class="p">;</span>
<span class="nb">let </span>thunkify <span class="o">=</span> require<span class="o">(</span><span class="s1">'thunkify'</span><span class="o">)</span><span class="p">;</span>
<span class="nb">let </span>readFileThunk <span class="o">=</span> thunkify<span class="o">(</span>fs.readFile<span class="o">)</span><span class="p">;</span>

<span class="nb">let </span>gen <span class="o">=</span> <span class="k">function*</span> <span class="o">(){</span>
  <span class="nb">let </span>r1 <span class="o">=</span> yield readFileThunk<span class="o">(</span><span class="s1">'/etc/fstab'</span><span class="o">)</span><span class="p">;</span>
  console.log<span class="o">(</span>r1.toString<span class="o">())</span><span class="p">;</span>
  <span class="nb">let </span>r2 <span class="o">=</span> yield readFileThunk<span class="o">(</span><span class="s1">'/etc/shells'</span><span class="o">)</span><span class="p">;</span>
  console.log<span class="o">(</span>r2.toString<span class="o">())</span><span class="p">;</span>
<span class="o">}</span><span class="p">;</span>
//å…ˆçœ‹å¦‚ä½•æ‰‹åŠ¨æ‰§è¡Œä¸Šé¢è¿™ä¸ª Generator å‡½æ•°
<span class="nb">let </span>g <span class="o">=</span> gen<span class="o">()</span><span class="p">;</span>
<span class="nb">let </span>r1 <span class="o">=</span> g.next<span class="o">()</span><span class="p">;</span>
r1.value<span class="o">(</span><span class="k">function</span> <span class="o">(</span>err, data<span class="o">)</span> <span class="o">{</span>
  <span class="k">if</span> <span class="o">(</span>err<span class="o">)</span> throw err<span class="p">;</span>
  <span class="nb">let </span>r2 <span class="o">=</span> g.next<span class="o">(</span>data<span class="o">)</span><span class="p">;</span>
  r2.value<span class="o">(</span><span class="k">function</span> <span class="o">(</span>err, data<span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span>err<span class="o">)</span> throw err<span class="p">;</span>
    g.next<span class="o">(</span>data<span class="o">)</span><span class="p">;</span>
  <span class="o">})</span><span class="p">;</span>
<span class="o">})</span><span class="p">;</span>
//å¯ä»¥å‘ç° Generator å‡½æ•°çš„æ‰§è¡Œè¿‡ç¨‹ï¼Œå…¶å®æ˜¯å°†åŒä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œåå¤ä¼ å…¥nextæ–¹æ³•çš„valueå±æ€§ã€‚è¿™ä½¿å¾—æˆ‘ä»¬å¯ä»¥ç”¨é€’å½’æ¥è‡ªåŠ¨å®Œæˆè¿™ä¸ªè¿‡ç¨‹
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="thunk-å‡½æ•°çš„è‡ªåŠ¨æµç¨‹ç®¡ç†">Thunk å‡½æ•°çš„è‡ªåŠ¨æµç¨‹ç®¡ç†</h2>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td><td class="rouge-code"><pre>//åŸºäº Thunk å‡½æ•°çš„ Generator æ‰§è¡Œå™¨
<span class="k">function </span>run<span class="o">(</span>fn<span class="o">)</span> <span class="o">{</span>
  <span class="nb">let </span>gen <span class="o">=</span> fn<span class="o">()</span><span class="p">;</span>
//nextå°±æ˜¯thunkå‡½æ•°çš„å›è°ƒå‡½æ•°
  <span class="k">function </span>next<span class="o">(</span>err, data<span class="o">)</span> <span class="o">{</span>
    <span class="nb">let </span>result <span class="o">=</span> gen.next<span class="o">(</span>data<span class="o">)</span><span class="p">;</span>
    <span class="k">if</span> <span class="o">(</span>result.done<span class="o">)</span> <span class="k">return</span><span class="p">;</span>
    result.value<span class="o">(</span>next<span class="o">)</span><span class="p">;</span>
  <span class="o">}</span>

  next<span class="o">()</span><span class="p">;</span>
<span class="o">}</span>

<span class="k">function*</span> g<span class="o">()</span> <span class="o">{</span>
  // ...
<span class="o">}</span>

run<span class="o">(</span>g<span class="o">)</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<h2 id="coæ¨¡å—">coæ¨¡å—</h2>

<blockquote>
  <p>ç”¨äº Generator å‡½æ•°çš„è‡ªåŠ¨æ‰§è¡Œï¼Œcoæ¨¡å—çº¦å®šï¼Œyieldå‘½ä»¤åé¢åªèƒ½æ˜¯ Thunk å‡½æ•°æˆ– Promise å¯¹è±¡</p>
</blockquote>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre></td><td class="rouge-code"><pre>const fs <span class="o">=</span> require<span class="o">(</span><span class="s2">"fs"</span><span class="o">)</span>.promises

<span class="k">function*</span> <span class="nb">read</span><span class="o">()</span> <span class="o">{</span>
    <span class="nb">let </span>name <span class="o">=</span> yield fs.readFile<span class="o">(</span><span class="s2">"name.txt"</span>, <span class="s2">"utf8"</span><span class="o">)</span>
    <span class="nb">let </span>age <span class="o">=</span> yield fs.readFile<span class="o">(</span>name, <span class="s2">"utf8"</span><span class="o">)</span>
    <span class="nb">let </span>xx <span class="o">=</span> yield <span class="o">{</span> a: age + 20 <span class="o">}</span>
    <span class="k">return </span>xx
<span class="o">}</span>
co<span class="o">(</span><span class="nb">read</span><span class="o">)</span>.then<span class="o">(</span>data <span class="o">=&gt;</span> <span class="o">{</span>
    console.log<span class="o">(</span>data<span class="o">)</span>
<span class="o">})</span>
//æºç å®ç°å¦‚ä¸‹ï¼š
<span class="k">function </span>co<span class="o">(</span>gen<span class="o">)</span> <span class="o">{</span>
    <span class="nb">let </span>self <span class="o">=</span> this
    <span class="k">return </span>new Promise<span class="o">((</span>resolve, reject<span class="o">)</span> <span class="o">=&gt;</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span>typeof gen <span class="o">===</span> <span class="s2">"function"</span><span class="o">)</span> <span class="o">{</span>
            gen <span class="o">=</span> gen.call<span class="o">(</span>self<span class="o">)</span>
        <span class="o">}</span>
        <span class="k">function </span>next<span class="o">(</span>data<span class="o">)</span> <span class="o">{</span>
            <span class="nb">let</span> <span class="o">{</span> value, <span class="k">done</span> <span class="o">}</span> <span class="o">=</span> gen.next<span class="o">(</span>data<span class="o">)</span>
            <span class="k">if</span> <span class="o">(</span><span class="k">done</span><span class="o">)</span> <span class="o">{</span>
                resolve<span class="o">(</span>value<span class="o">)</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                Promise.resolve<span class="o">(</span>value<span class="o">)</span>.then<span class="o">(</span>data <span class="o">=&gt;</span> <span class="o">{</span>
                    console.log<span class="o">(</span>data<span class="o">)</span>
                    next<span class="o">(</span>data<span class="o">)</span>
                <span class="o">}</span>, err <span class="o">=&gt;</span> console.log<span class="o">(</span>err<span class="o">))</span>
            <span class="o">}</span>

        <span class="o">}</span>
        next<span class="o">()</span>
    <span class="o">})</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>
:ET