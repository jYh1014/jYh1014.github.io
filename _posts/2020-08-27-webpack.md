---
title: webpack
author: jyy
date: 2020-08-27 11:20:00 +0800
# categories: [Blogging, Tutorial]
tags: [webpack]
pin: true
---

## webpack是什么

>定义: webpack 是一个打包模块化 JavaScript 的工具，专注构建模块化项目，在 webpack 里一切文件皆模块，通过 loader 转换文件，通过 plugin 注入钩子，它会递归地构建一个依赖关系图(dependency graph)，其中包含应用程序需要的每个模块，然后将所有这些模块打包成一个或多个 bundle

>loader: 用于对模块的源代码进行转换,描述了 webpack 如何处理 非 JavaScript(non-JavaScript) _模块_，并且在 bundle 中引入这些依赖。（这个模块需要导出一个函数。这个导出函数的工作就是获得处理前的原内容，对原内容执行处理后，返回处理后的内容。）

>plugin: 是一个具有 apply 属性的 JavaScript 对象,apply 属性会被 webpack compiler 调用，并且 compiler 对象可在整个编译生命周期访问。webpack 运行的生命周期中会广播出许多事件，plugin 可以监听这些事件，在合适的时机通过 webpack 提供的 API 执行相应的操作

> loader和plugin的区别：loader操作的是文件；plugin是基于事件机制，监听这些事件，在合适的时机通过 webpack 提供的 API 执行相应的操作。针对整个构建过程起作用，
## webpack的运行流程

- 1.初始化参数: 从配置文件以及 ***shell***语句、webpack默认配置中得到最终的参数
- 2.开始编译：用上一步得到的参数初始化 Compiler 对象，加载所有配置的插件，执行对象的 run 方法开始执行编译；

```sh
const webpack = (options, callback) => {
    if(typeof options === "object"){
        options.context = options.context || process.cwd()
        let compiler = new Compiler(options.context)
        compiler.options = options
        new NodeEnvironmentPlugin().apply(compiler)
        if(options.plugins && Array.isArray(options.plugins)){
            for(let plugin of options.plugins){
                if(typeof plugin === "function"){
                    plugin.call(compiler, compiler)
                }else{
                    plugin.apply(compiler)
                }
            }
        }
        new WebpackOptionsApply().process(options,compiler)
        return compiler
    }
}
```

- 3.编译模块：每当检测到文件变化，一次新的Compilation将被创建。从Entry开始读取文件，根据文件类型和配置的Loader对文件进行编译，编译完后再找出该文件依赖的文件，递归的编译和解析。（build-module：使用对应的Loader去转换一个模块；在用Loader对一个模块转换完后，使用acorn解析转换后的内容，输出对应的抽象语法树（AST），从配置的入口模块开始，分析其AST，当遇到require等导入其它模块语句时，便将其加入到依赖的模块列表，同时对新找出的依赖模块递归分析，最终搞清所有模块的依赖关系。）

- 4.封装代码块：根据入口和模块之间的依赖关系新增相应的chunk文件，把所有的模块中名称和此代码块名称一样的都放到这个chunk.modules中,确定好chunk内容，再把每个chunk转换成单独的资源文件加入到输出列表中。
- 5.发射资源：根据配置确定输出的路径和文件名，把文件内容写入到文件系统。

## 常用的loader
- file-loader: 把文件输出到一个文件夹中，在代码中通过相对 URL 去引用输出的文件
- url-loader: 和 file-loader 类似，但是能在文件很小的情况下以 base64 的方式把文件内容注入到代码中去
- image-loader: 加载并且压缩图片文件
- babel-loader: 把 ES6 转换成 ES5
- css-loader: 加载 CSS，支持模块化、压缩、文件导入等特性
- style-loader: 把 CSS 代码注入到 JavaScript 中，通过 DOM 操作去加载 CSS
- postcss-loader: 扩展 CSS 语法，使用下一代 CSS，可以配合 autoprefixer 插件自动补齐 CSS3 前缀


## 常用的plugin
- html-webpack-plugin
- happypack
- clean-webpack-plugin
- purgecss-webpack-plugin：删除无用的css代码
- mini-css-extract-plugin：分离样式文件，CSS 提取为独立文件，支持按需加载

## 性能优化
- 1.删除无用的css样式
- 2.图片压缩插件
- 3.cnd加载文件
- 4.tree-shakings && scope hoisting
- 5.dllplugin
- 6.动态加载 import，原理是jsonp动态导入


## webpack路由懒加载

## webpack和gulp的使用以及区别

## webpack解决跨域的原理：http-proxy-middleware代理中间件



